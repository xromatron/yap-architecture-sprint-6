# Задание 3. Переход на Event-Driven архитектуру

## Проблемы и риски

1. core-app и ins-comp-settlement запрашивают и ждут ответа от ins-product-aggregator,
ответ и сейчас бывает не всегда, а с увеличением количества опрашиваемых систем в два
раза проблема усугубится
2. если у нас настроен retry, это приведет к повторному вызову ins-product-aggregator
и повторным запросам в страховые, даже в те, что в предыдущий раз уже ответили
3. при вызове ins-comp-settlement к к ins-product-aggregator может совпасть с вызовом
core-app и сервис не справится с резким повышением нагрузки, либо страховые откажут в
ответе, если у них установлен например RPS = 1 для нашего агрегатора
4. запрос ins-comp-settlement в core-app раз в сутки по выгрузке всех страховок за день
также приводит к росту нагрузки, может повлиять на работу обычных пользователей

Предлагаемое решение:
1. если невозможно изменить взаимодействие со страховыми компаниями на подписку на
изменение тарифов, то переносим выполнение cron-job в ins-product-aggregator. Для обновления
тарифов каждой страховой компании можно сделать отдельные правила запуска cron-job.
2. информация об изменении тарифов по каждой страховой компании отправляется ins-product-aggregator
в топик (например TARIFFS_CHANGED), из которого вычитывают core-app и ins-comp-settlement
и обновляют информацию в своих локальных репликах
3. информация об оформлении страховки core-app сохраняется в БД и отправляется с использованием
Transactional Outbox в топик, из которого вычитывается ins-comp-settlement и сохраняется в свою БД