# Задание 4. Проектирование продажи ОСАГО

## osago-aggregator
1. Требуется ли ему своё хранилище данных:
хранение данных краткосрочное, т.к. ждем ответа от страховых макс 60 сек - 
значит достаточно кэша
2. Какой API он предоставляет core-app:
async API, обмен событиями через брокер сообщений
3. Определите средство интеграции между сервисами core-app и osago-aggregator:
   - core-app публикует сообщение о новой заявке на ОСАГО  
   - osago-aggregator получает событие и сохраняет в кэш, после чего отправляет запросы
   в страховые компании и с заданной периодичностью опрашивает стразовые на наличие расчета
   - при получении каждого расчета публикует событие с указанием пользователя и данных расчета
   - core-app вычитывает события и предоставляет информацию вэб-приложению
4. Подумайте над API для веб-приложения в core-app:
так же asyncApi 
5. Определите средство интеграции между веб-приложением и core-app:
- устанавливается соединение websocket между приложением и core-app
- отправляются запросы, ответы о расчетах направляются по мере поступления событий
6. В зависимости от выбранных средств интеграции подумайте, требуется ли где-то применение паттернов отказоустойчивости:
   - Rate Limiting - да, в core-app для запросов от партнеров, для равномерного использования всеми  
   - Circuit Breaker - нет, даже если какая-то из страховых компаний не будет отвечать,
   osago-aggregator будет отправлять информацию только по успешно полученным расчетам  
   - Retry - да, при запросах к страховым  
   - Timeout - да, при запросах к страховым  
7. Примите во внимание, что сервисы задеплоены в нескольких экземплярах. Подумайте, зависит ли ваше решение от этого.  
- У каждого пода core-app своя группа, т.е. получает все события из брокера и выбирает для
пользователей, с которыми есть соединение
- osago-aggregator у всех подов одна группа, т.е. события делятся между ними, что решает 
вопрос дублирования запросов в страховые